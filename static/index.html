<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
  </head>
  <body>

    <ul id="car-list">
    </ul>

    <script src="https://cdn.socket.io/4.4.1/socket.io.min.js" integrity="sha384-fKnu0iswBIqkjxrhQCTZ7qlLHOFEgNkRmK2vaO/LbTZSXdJfAu6ewRBdwHPhBo/H" crossorigin="anonymous"></script>
    <script>
      const socket = io();
      const cars = new Map();

      const carList = document.getElementById('car-list');

      const formatData = (clientId, data) => clientId + ": " + JSON.stringify(data);

      socket.on("update", data => {
        const clientId = data['client_id'];
        delete data['client_id'];

        if (cars.has(clientId)) {
          cars.get(clientId).textContent = formatData(clientId, data);
        } else {
          const newEntry = document.createElement("li");
          newEntry.textContent = formatData(clientId, data);
          cars.set(clientId, newEntry)
          carList.appendChild(newEntry)
        }
      })
    </script>
  </body>
</html>
